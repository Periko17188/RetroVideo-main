<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>RetroVideo - Proyecto Final DAW</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Inter',sans-serif;background-color:#141414;color:#E5E5E5}
        .header{background-color:#141414;z-index:10}
        .movie-card{transition:transform .3s, box-shadow .3s}
        .movie-card:hover{transform:scale(1.05);box-shadow:0 10px 20px rgba(0,0,0,.6)}
        .modal{background-color:rgba(0,0,0,.85);z-index:50}
        .modal input,.modal textarea{background:#333;color:#fff;border:1px solid #444}
        .animate-pulse-slow{animation:pulse 4s cubic-bezier(.4,0,.6,1) infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.8}}

        /* Carrito */
        #cart-container{position:relative}
        #cart-btn{position:relative}
        #cart-badge{
          position:absolute; right:-6px; bottom:-6px;
          min-width:18px; height:18px; padding:0 4px;
          background:#dc2626; color:#fff; border-radius:9999px;
          font-size:11px; line-height:18px; text-align:center; display:none;
        }
        #cart-dropdown{
          position:absolute; left:0; top:100%;
          background:#2d2d2d; border-radius:10px; box-shadow:0 8px 16px rgba(0,0,0,.5);
          width:340px; padding:12px; display:none;
        }
        .cart-item{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #444;padding:6px 0}
        .cart-item-title{font-size:.9rem}
        .cart-total{font-weight:700;margin-top:10px}
    </style>
</head>
<body class="min-h-screen">

<!-- HEADER -->
<header class="header sticky top-0 p-4 flex justify-end items-center shadow-lg">
    <div class="flex space-x-4 items-center">

        <!-- Registro / Login (cuando NO hay sesi√≥n) -->
        <button id="open-register-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition">
            Registrarse
        </button>
        <button id="open-login-btn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition">
            Iniciar Sesi√≥n
        </button>

        <!-- Carrito: a la IZQUIERDA de Bienvenida (solo USER, no ADMIN) -->
        <div id="cart-container" class="hidden">
            <button id="cart-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition flex items-center gap-2">
                üõí
                <span id="cart-badge">0</span>
            </button>
            <div id="cart-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-gray-800 rounded-md shadow-lg z-50 p-4">
                <h3 class="text-lg font-semibold text-white mb-3">Tu Carrito</h3>
                <div id="cart-items-list" class="space-y-2">
                    <!-- Los √≠tems se renderizar√°n aqu√≠ -->
                </div>
                <div class="mt-4 pt-4 border-t border-gray-700">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-white">Total:</span>
                        <span id="cart-total" class="font-bold text-lg text-white">0.00‚Ç¨</span>
                    </div>
                    <button onclick="checkout()" 
                            class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        Finalizar Compra
                    </button>
                </div>
            </div>
        </div>

        <!-- Bienvenida + Logout -->
        <span id="user-display" class="hidden bg-green-600 text-white font-semibold py-2 px-4 rounded"></span>
        <button id="logout-btn" class="hidden bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded transition">
            Cerrar Sesi√≥n
        </button>
    </div>
</header>

<!-- SPLASH -->
<div id="splash-screen" class="flex flex-col items-center justify-center min-h-[calc(100vh-80px)] text-center px-4">
    <div class="text-red-600 text-6xl sm:text-7xl md:text-8xl font-black mb-8 animate-pulse-slow">RetroVideo</div>
    <p class="text-xl text-gray-300 mb-12 max-w-lg">
        Disfruta de pel√≠culas ilimitadas. Inicia sesi√≥n o reg√≠strate para acceder al cat√°logo.
    </p>
</div>

<!-- MAIN -->
<main id="main-content" class="p-8 hidden">

    <!-- ADMIN CONTROLS -->
    <div id="admin-controls" class="mb-8 flex flex-wrap gap-4">
        <!-- Backup Button -->
        <button id="backup-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition-colors">
            <i class="fas fa-database"></i>
            <span>Generar Copia de Seguridad</span>
            <span id="backup-spinner" class="hidden ml-2">
                <i class="fas fa-spinner fa-spin"></i>
            </span>
        </button>
    </div>

    <!-- MOVIE FORM (solo para Pedro) -->
    <section id="movie-form-section" class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8 hidden">
        <h2 class="text-2xl font-bold mb-4 text-red-600">Gesti√≥n de Pel√≠culas (ADMIN)</h2>
        <form id="movie-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="hidden" id="movieId" name="movieId">

            <div class="md:col-span-1">
                <label for="titulo" class="block text-sm font-medium mb-1">T√≠tulo:</label>
                <input type="text" id="titulo" name="titulo" required class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white">
            </div>

            <div class="md:col-span-1">
                <label for="anio" class="block text-sm font-medium mb-1">A√±o (ej: 2025):</label>
                <input type="number" 
                       id="anio" 
                       name="anio" 
                       required 
                       min="1895"
                       max="2500"
                       oninput="validateYear(this)"
                       class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white">
                <p id="year-error" class="text-red-400 text-xs mt-1 hidden">El a√±o debe 4 d√≠gitos</p>
            </div>

            <div class="md:col-span-2">
                <label for="sinopsis" class="block text-sm font-medium mb-1">Sinopsis (Max 1000 chars):</label>
                <textarea id="sinopsis" name="sinopsis" maxlength="1000" required class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white h-24"></textarea>
            </div>

            <div class="md:col-span-1">
                <label for="rating" class="block text-sm font-medium mb-1">Puntuaci√≥n (0.0 a 10.0):</label>
                <input type="number" id="rating" name="rating" step="0.1" min="0" max="10" required class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white">
            </div>

            <div class="md:col-span-1">
                <label class="block text-sm font-medium mb-1">Imagen de la pel√≠cula:</label>
                <div class="flex items-center">
                    <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white text-sm py-1 px-3 rounded transition inline-flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Seleccionar Imagen</span>
                        <input type="file" id="imagenFile" name="imagenFile" accept="image/*" class="hidden" onchange="updateImagePreview(this)">
                    </label>
                    <span id="selected-file-name" class="ml-2 text-xs text-gray-300 truncate max-w-xs"></span>
                </div>
                <input type="hidden" id="imagenUrl" name="imagenUrl">
                <div id="image-preview" class="mt-2 hidden">
                    <p class="text-xs text-gray-400 mb-1">Vista previa:</p>
                    <img id="image-preview-img" src="#" alt="Vista previa" class="max-h-24 rounded border border-gray-600">
                </div>
            </div>

            <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-1">G√©nero:</label>
                <div id="genre-select-container" class="relative"><!-- select por JS --></div>
                <p id="genre-load-message" class="text-sm text-gray-400 mt-2">Cargando g√©neros...</p>
            </div>

            <div class="md:col-span-2 flex justify-end space-x-4">
                <button type="button" id="cancel-edit-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition hidden">Cancelar Edici√≥n</button>
                <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition">Guardar Pel√≠cula</button>
            </div>

            <p id="form-message" class="md:col-span-2 text-center mt-2 hidden"></p>
        </form>
    </section>

    <h1 class="text-4xl font-bold mb-8">Cat√°logo Completo</h1>

    <!-- FILTROS -->
    <section class="mb-8">
        <h2 class="text-2xl font-semibold mb-4">Filtrar Contenido</h2>
        <div id="genres-container" class="flex flex-wrap gap-3"><!-- botones por JS --></div>
    </section>

    <!-- PEL√çCULAS -->
    <section>
        <h2 class="text-2xl font-semibold mb-4">Todas las Pel√≠culas</h2>
        <div id="movies-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            <!-- tarjetas por JS -->
        </div>
        <p id="no-movies-message" class="hidden text-xl text-center mt-10">No hay pel√≠culas que coincidan con el filtro.</p>
    </section>
</main>

<!-- LOGIN MODAL -->
<div id="login-modal" class="modal fixed inset-0 hidden items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md">
        <div class="flex justify-end">
            <button class="text-gray-400 hover:text-white text-2xl" onclick="closeModal('login-modal')">&times;</button>
        </div>
        <h3 class="text-3xl font-bold text-white mb-6 text-center">Inicia Sesi√≥n en RetroVideo</h3>
        <div id="login-message" class="text-red-400 mb-4 hidden"></div>

        <label for="login-username" class="block text-sm font-medium mb-2">Usuario</label>
        <input type="text" id="login-username" class="w-full p-3 mb-4 rounded" value="Pedro">

        <label for="login-password" class="block text-sm font-medium mb-2">Contrase√±a</label>
        <input type="password" id="login-password" class="w-full p-3 mb-6 rounded" value="12341234">

        <button onclick="handleLogin()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded transition">
            Entrar
        </button>
    </div>
</div>

<!-- REGISTER MODAL -->
<div id="register-modal" class="modal fixed inset-0 hidden items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md">
        <div class="flex justify-end">
            <button class="text-gray-400 hover:text-white text-2xl" onclick="closeModal('register-modal')">&times;</button>
        </div>
        <h3 class="text-3xl font-bold text-white mb-6 text-center">Crea tu Cuenta RetroVideo</h3>
        <div id="register-message" class="mb-4 text-center hidden"></div>

        <label for="register-username" class="block text-sm font-medium mb-2">Nuevo Usuario</label>
        <input type="text" id="register-username" class="w-full p-3 mb-4 rounded" placeholder="Escribe tu nombre de usuario">

        <label for="register-password" class="block text-sm font-medium mb-2">Contrase√±a (M√≠nimo 8)</label>
        <input type="password" id="register-password" class="w-full p-3 mb-6 rounded" placeholder="Escribe tu contrase√±a">
        <button onclick="handleRegister()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded transition">
            Registrarse
        </button>
    </div>
</div>

<!-- FOOTER -->
<footer class="bg-gray-900 border-t border-gray-800 mt-16">
    <div class="max-w-7xl mx-auto px-8 py-12">
        <!-- Footer Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
            
            <!-- Logo & Copyright -->
            <div class="col-span-1 md:col-span-2">
                <h3 class="text-red-600 text-3xl font-black mb-4">RetroVideo</h3>
                <p class="text-gray-400 text-sm mb-4 max-w-md">
                    Tu plataforma de streaming favorita. Disfruta de las mejores pel√≠culas desde la comodidad de tu hogar.
                </p>
                <p class="text-gray-500 text-sm">
                    ¬© 2025 RetroVideo. Todos los derechos reservados.
                </p>
            </div>

            <!-- Empresa -->
            <div>
                <h4 class="text-white font-semibold mb-4">Empresa</h4>
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Sobre Nosotros</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Contacto</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Trabaja con Nosotros</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Prensa</a>
                    </li>
                </ul>
            </div>

            <!-- Soporte & Legal -->
            <div>
                <h4 class="text-white font-semibold mb-4">Soporte & Legal</h4>
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Centro de Ayuda</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Soporte T√©cnico</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">T√©rminos y Condiciones</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Pol√≠tica de Privacidad</a>
                    </li>
                    <li>
                        <a href="#" class="text-gray-400 hover:text-red-600 text-sm transition-colors">Pol√≠tica de Cookies</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Social Media & Bottom Bar -->
        <div class="pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center">
            <div class="flex space-x-6 mb-4 md:mb-0">
                <a href="#" class="text-gray-400 hover:text-red-600 transition-colors" aria-label="Facebook">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-red-600 transition-colors" aria-label="Twitter">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-red-600 transition-colors" aria-label="Instagram">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-red-600 transition-colors" aria-label="YouTube">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                </a>
            </div>
            <p class="text-gray-500 text-xs text-center md:text-right">
                Desarrollado para el Proyecto Final DAW
            </p>
        </div>
    </div>
</footer>

<script>
    const API_URL = 'http://localhost:8080/api/v1';

    // Estado global
    let movies = [];
    let genres = [];
    let isAuthenticated = false;
    let authUsername = null;
    let authPassword = null;
    let currentEditId = null;

    // Carrito (solo para USER)
    let cart = []; // {id, titulo}

    // --- Modales ---
    function openModal(id){
      const el=document.getElementById(id);
      el.classList.remove('hidden');el.classList.add('flex');
      if(id==='login-modal') document.getElementById('login-message').classList.add('hidden');
      if(id==='register-modal') document.getElementById('register-message').classList.add('hidden');
    }
    function closeModal(id){
      const el=document.getElementById(id);
      el.classList.add('hidden');el.classList.remove('flex');
      if(id==='movie-form-section') resetMovieForm();
    }

    // --- UI seg√∫n sesi√≥n ---
    function updateUI(user, logged=false){
      const openLogin=document.getElementById('open-login-btn');
      const openRegister=document.getElementById('open-register-btn');
      const logoutBtn=document.getElementById('logout-btn');
      const userDisplay=document.getElementById('user-display');
      const movieFormSection=document.getElementById('movie-form-section');
      const splash=document.getElementById('splash-screen');
      const main=document.getElementById('main-content');
      const cartContainer=document.getElementById('cart-container');

      isAuthenticated = logged;
      authUsername = user || null;

      if(logged){
        splash.classList.add('hidden'); main.classList.remove('hidden');
        openLogin.classList.add('hidden'); openRegister.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
        userDisplay.textContent = `Bienvenida, ${user}`; // texto solicitado
        userDisplay.classList.remove('hidden');

        // Mostrar controles de admin solo para Pedro
        const isAdmin = user === 'Pedro';
        movieFormSection?.classList.toggle('hidden', !isAdmin);
        document.getElementById('admin-controls')?.classList.toggle('hidden', !isAdmin);

        // Carrito: solo usuarios normales (no admin)
        cartContainer.classList.toggle('hidden', isAdmin);

      }else{
        splash.classList.remove('hidden'); main.classList.add('hidden');
        openLogin.classList.remove('hidden'); openRegister.classList.remove('hidden');
        logoutBtn.classList.add('hidden'); userDisplay.classList.add('hidden');
        movieFormSection?.classList.add('hidden');
        document.getElementById('cart-container').classList.add('hidden');
      }
    }

    function handleLogout(){
      authUsername=null; authPassword=null;
      cart = []; updateCartUI();
      updateUI(null,false);
      showCustomMessage('Has cerrado sesi√≥n correctamente.','success');
    }

    // --- Login / Registro ---
    async function handleLogin(){
      const username=document.getElementById('login-username').value;
      const password=document.getElementById('login-password').value;
      const msg=document.getElementById('login-message');
      msg.classList.add('hidden');
      const base64=btoa(`${username}:${password}`);

      try{
        const res=await fetch(`${API_URL}/peliculas`,{headers:{'Authorization':`Basic ${base64}`}});

        if(res.ok){
          authUsername=username; authPassword=password;
          updateUI(username,true);
          closeModal('login-modal');
          await fetchGenres();
          await fetchMovies();
          showCustomMessage(`¬°Inicio de sesi√≥n exitoso! Bienvenida, ${username}.`,'success');
        }else if(res.status===401){
          msg.textContent='Usuario o contrase√±a incorrectos.'; msg.classList.remove('hidden');
        }else{
          msg.textContent='Error desconocido al iniciar sesi√≥n.'; msg.classList.remove('hidden');
        }
      }catch(err){
        msg.textContent='Error de conexi√≥n con el servidor.'; msg.classList.remove('hidden');
      }
    }

    async function handleRegister(){
      const username=document.getElementById('register-username').value;
      const password=document.getElementById('register-password').value;
      const msg=document.getElementById('register-message');
      msg.classList.add('hidden'); msg.classList.remove('text-red-400','text-green-400');

      if(username.length<3 || password.length<8){
        msg.textContent='El usuario debe tener al menos 3 caracteres y la contrase√±a al menos 8.';
        msg.classList.remove('hidden'); msg.classList.add('text-red-400'); return;
      }
      try{
        const res=await fetch(`${API_URL}/registro`,{
          method:'POST', headers:{'Content-Type':'application/json'},
          body:JSON.stringify({username,password})
        });
        if(res.status===201){
          msg.textContent=`¬°Registro exitoso! Ya puedes iniciar sesi√≥n con ${username}.`;
          msg.classList.remove('hidden'); msg.classList.add('text-green-400');
          document.getElementById('register-username').value='';
          document.getElementById('register-password').value='';
        }else if(res.status===400){
          msg.textContent='El nombre de usuario ya est√° en uso.';
          msg.classList.remove('hidden'); msg.classList.add('text-red-400');
        }else{
          msg.textContent=`Error ${res.status} al registrar.`; msg.classList.remove('hidden'); msg.classList.add('text-red-400');
        }
      }catch(e){
        msg.textContent='Error de conexi√≥n con el servidor.'; msg.classList.remove('hidden'); msg.classList.add('text-red-400');
      }
    }

    // --- Form Admin ---
    function resetMovieForm(){
      const form=document.getElementById('movie-form');
      form.reset(); 
      currentEditId=null;
      document.getElementById('form-message').classList.add('hidden');
      document.getElementById('cancel-edit-btn').classList.add('hidden');
      document.getElementById('image-preview').classList.add('hidden');
      document.getElementById('selected-file-name').textContent = '';
      document.getElementById('imagenUrl').value = '';
      form.querySelector('button[type="submit"]').textContent='Guardar Pel√≠cula';
    }

    async function handleMovieFormSubmit(e){
      e.preventDefault();
      
      const form = e.target;
      const formData = new FormData(form);
      const fileInput = document.getElementById('imagenFile');
      const genreSelect = document.getElementById('genreId');
      
      // Validar que se haya seleccionado un g√©nero
      if (!genreSelect.value) {
          showCustomMessage('Debes seleccionar al menos un g√©nero', 'error');
          return;
      }
      
      // Crear objeto con los datos del formulario
      const movieData = {
          titulo: form.titulo.value,
          sinopsis: form.sinopsis.value,
          anio: parseInt(form.anio.value),
          rating: parseFloat(form.rating.value),
          imagenUrl: form.imagenUrl.value,
          genreIds: [parseInt(genreSelect.value)]
      };
      
      // Si hay un archivo seleccionado, lo a√±adimos al FormData
      if (fileInput.files[0]) {
          const fileName = fileInput.files[0].name;
          movieData.imagenUrl = fileName;
          formData.append('file', fileInput.files[0]);
      }
      const msg=document.getElementById('form-message');
      msg.classList.add('hidden'); msg.classList.remove('text-green-400','text-red-400');

      if(!isAuthenticated || !authUsername || !authPassword){
        msg.textContent='Debes iniciar sesi√≥n como ADMIN.'; msg.classList.remove('hidden'); msg.classList.add('text-red-400'); return;
      }

      const base64=btoa(`${authUsername}:${authPassword}`);
      const headers={'Content-Type':'application/json','Authorization':`Basic ${base64}`};

      let url=`${API_URL}/peliculas`; let method='POST';
      if(currentEditId){ url=`${API_URL}/peliculas/${currentEditId}`; method='PUT'; }

      try{
        const res=await fetch(url,{method,headers,body: JSON.stringify(movieData),credentials: 'include'});
        const expected = method==='POST'?201:200;
        if(res.status===expected){
          msg.textContent=`Pel√≠cula "${movieData.titulo}" ${method==='POST'?'a√±adida':'actualizada'} correctamente.`;
          msg.classList.remove('hidden'); msg.classList.add('text-green-400');
          resetMovieForm(); await fetchMovies();
        }else if(res.status===401 || res.status===403){
          msg.textContent='No tienes permisos de ADMIN.'; msg.classList.remove('hidden'); msg.classList.add('text-red-400');
        }else{
          const t=await res.text();
          msg.textContent=`Error ${res.status}: ${t.substring(0,100)}...`; msg.classList.remove('hidden'); msg.classList.add('text-red-400');
        }
      }catch(e){
        msg.textContent='Error de conexi√≥n con el servidor.'; msg.classList.remove('hidden'); msg.classList.add('text-red-400');
      }
    }

    // --- Mensajes superiores (confirmaciones) ---
    function showCustomMessage(text,type='info'){
      let box=document.getElementById('custom-message-box');
      if(!box){
        box=document.createElement('div');
        box.id='custom-message-box';
        box.className='fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-4 rounded-lg shadow-xl text-center transition-opacity duration-500 opacity-0 z-50';
        document.body.appendChild(box);
      }
      box.textContent=text;
      box.className = 'fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-4 rounded-lg shadow-xl text-center transition-opacity duration-500 z-50 ' + (type==='success'?'bg-green-600 text-white':'bg-yellow-500 text-white');
      box.style.opacity='1';
      setTimeout(()=>{box.style.opacity='0';},3000);
    }

    // --- Pel√≠culas y G√©neros ---
    function createMovieCard(movie){
      const card=document.createElement('div');
      card.className='movie-card bg-gray-900 rounded-lg overflow-hidden relative';
      const imageFileName=movie.imagenUrl;
      const imageUrl=imageFileName?`images/${imageFileName}`:null;
      const placeholder='images/placeholder.png';
      const genreName=(movie.generos && movie.generos.length>0)?movie.generos[0].nombre:'Desconocido';

      card.innerHTML=`
        <img src="${imageUrl?imageUrl:placeholder}" alt="${movie.titulo}"
             onerror="this.onerror=null; this.src='${placeholder}';"
             class="w-full h-auto object-cover rounded-t-lg aspect-[2/3]">
        <div class="p-4">
          <h4 class="text-lg font-bold truncate">${movie.titulo}</h4>
          <p class="text-sm text-gray-400">${movie.anio} | ${genreName}</p>
          <p class="text-sm text-yellow-500 mt-1">‚≠ê ${movie.rating!=null?movie.rating.toFixed(1):'N/A'} / 10</p>
          <div class="mt-3 flex items-center justify-between">
          <button
              class="buy-btn bg-red-600 hover:bg-red-700 text-white text-sm font-semibold py-1 px-3 rounded transition hidden"
              data-movie-id="${movie.id}">Comprar Pel√≠cula
            </button>            <div class="admin-buttons space-x-2 hidden"></div>
          </div>
        </div>
      `;

      // Botones admin (Pedro)
      if(authUsername==='Pedro'){
        const adminDiv=card.querySelector('.admin-buttons');
        adminDiv.classList.remove('hidden');

        const editBtn=document.createElement('button');
        editBtn.innerHTML='‚úèÔ∏è';
        editBtn.className='bg-blue-600 hover:bg-blue-700 text-white text-xs p-1 rounded';
        editBtn.title='Editar';
        editBtn.onclick=(e)=>{e.stopPropagation(); populateEditForm(movie);};
        adminDiv.appendChild(editBtn);

        const delBtn=document.createElement('button');
        delBtn.innerHTML='üóëÔ∏è';
        delBtn.className='bg-red-600 hover:bg-red-700 text-white text-xs p-1 rounded';
        delBtn.title='Eliminar';
        delBtn.onclick=(e)=>{e.stopPropagation(); handleDeleteMovie(movie.id,movie.titulo);};
        adminDiv.appendChild(delBtn);
      }

      // Bot√≥n comprar (solo USER)
      if(isAuthenticated && authUsername && authUsername!=='Pedro'){
        const buyBtn=card.querySelector('.buy-btn');
        buyBtn.classList.remove('hidden');
        buyBtn.onclick=()=>handleBuy(movie, buyBtn);
      }

      return card;
    }

    function renderMovies(list){
      const container=document.getElementById('movies-container');
      const message=document.getElementById('no-movies-message');
      container.innerHTML='';
      if(!Array.isArray(list)){message.textContent="Error al mostrar las pel√≠culas.";message.classList.remove('hidden');return;}
      if(list.length===0){message.textContent="No hay pel√≠culas que coincidan con el filtro actual.";message.classList.remove('hidden');}
      else{
        message.classList.add('hidden');
        list.forEach(m => m && m.titulo ? container.appendChild(createMovieCard(m)) : null);
      }
    }

    function filterAndRenderMovies(genreId){
      if(!Array.isArray(movies)) movies=[];
      let filtered=movies;
      if(genreId!=='all'){
        filtered=movies.filter(m => m.generos && m.generos.some(g => g.id===parseInt(genreId)));
      }
      document.querySelectorAll('.genre-btn').forEach(btn=>btn.classList.replace('bg-red-600','bg-gray-700'));
      const active=document.querySelector(`.genre-btn[data-genre-id="${genreId}"]`);
      if(active) active.classList.replace('bg-gray-700','bg-red-600');
      renderMovies(filtered);
    }

    function createGenreButton(genre){
      const b=document.createElement('button');
      b.textContent=genre.nombre;
      b.className='genre-btn bg-gray-700 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-full transition';
      b.dataset.genreId=genre.id;
      b.onclick=()=>filterAndRenderMovies(b.dataset.genreId);
      return b;
    }

    function handleFetchError(error,type){
      console.error(`Error al cargar ${type}:`, error);
      let containerId, formMessageId, errorMessage;
      if(type==='g√©neros'){containerId='genres-container';formMessageId='genre-load-message';errorMessage='Error: No se pudo conectar a la API para cargar los g√©neros.';}
      else{containerId='movies-container';formMessageId='no-movies-message';errorMessage='Error al conectar con el servidor de pel√≠culas.';}

      const container=document.getElementById(containerId);
      if(container){container.innerHTML=`<span class="text-red-400">${errorMessage} Aseg√∫rate de que el backend est√© ejecut√°ndose en http://localhost:8080.</span>`;}
      const formMsg=document.getElementById(formMessageId);
      if(formMsg){
        formMsg.textContent = type==='g√©neros' ? 'Error: No se pudieron cargar los g√©neros para el formulario.' : errorMessage;
        formMsg.classList.remove('hidden'); formMsg.classList.add('text-red-400');
      }
      if(type==='g√©neros') genres=[]; if(type==='pel√≠culas') movies=[];
      renderMovies([]);
    }

    async function fetchGenres(){
      try{
        let headers={};
        if(isAuthenticated && authUsername && authPassword){
          const base64=btoa(`${authUsername}:${authPassword}`); headers={'Authorization':`Basic ${base64}`};
        }
        const res=await fetch(`${API_URL}/generos`,{headers});
        if(!res.ok) throw new Error(`Error ${res.status}`);
        genres=await res.json();

        const cont=document.getElementById('genres-container'); cont.innerHTML='';
        const allBtn=document.createElement('button');
        allBtn.textContent='Todos';
        allBtn.className='genre-btn bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-full transition';
        allBtn.dataset.genreId='all';
        allBtn.onclick=()=>filterAndRenderMovies('all');
        cont.appendChild(allBtn);

        if(Array.isArray(genres)){
          genres.forEach(g=>{ if(g && g.nombre) cont.appendChild(createGenreButton(g)); });
        }else{ genres=[]; }

        const selectContainer=document.getElementById('genre-select-container');
        const selectMsg=document.getElementById('genre-load-message');
        if(selectContainer){
          let html=`<select id="genreId" name="genreId" required class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white">`;
          if(Array.isArray(genres)){ genres.forEach(g=>{ if(g && g.nombre) html+=`<option value="${g.id}">${g.nombre}</option>`; }); }
          html+='</select>';
          selectContainer.innerHTML=html; selectMsg.classList.add('hidden');
        }
      }catch(e){ handleFetchError(e,'g√©neros'); }
    }

    async function fetchMovies(){
      try{
        let headers={};
        if(isAuthenticated && authUsername && authPassword){
          const base64=btoa(`${authUsername}:${authPassword}`); headers={'Authorization':`Basic ${base64}`};
        }
        const res=await fetch(`${API_URL}/peliculas`,{headers});
        if(!res.ok) throw new Error(`Error ${res.status}`);
        movies=await res.json();
        if(!Array.isArray(movies)) movies=[];
        filterAndRenderMovies('all');
      }catch(e){ handleFetchError(e,'pel√≠culas'); }
    }

    // --- Admin: editar / borrar ---
    function populateEditForm(movie){
      const form=document.getElementById('movie-form');
      form.titulo.value=movie.titulo; form.anio.value=movie.anio; form.sinopsis.value=movie.sinopsis; form.rating.value=movie.rating;
      form.imagenUrl.value=movie.imagenUrl||'';
      form.genreId.value= movie.generos && movie.generos.length>0 ? movie.generos[0].id : '';
      currentEditId=movie.id;
      document.getElementById('cancel-edit-btn').classList.remove('hidden');
      form.querySelector('button[type="submit"]').textContent='Actualizar Pel√≠cula';
      document.getElementById('movie-form-section').scrollIntoView({behavior:'smooth'});
    }

    async function handleDeleteMovie(id,title){
      if(!confirm(`¬øEliminar "${title}"?`)) return;
      if(!isAuthenticated || !authUsername || !authPassword){ showCustomMessage('Debes iniciar sesi√≥n como ADMIN.','error'); return; }
      const base64=btoa(`${authUsername}:${authPassword}`);
      try{
        const res=await fetch(`${API_URL}/peliculas/${id}`,{method: 'DELETE',headers:
        {'Authorization': `Basic ${base64}`},credentials: 'include'});
        if(res.status===204){ showCustomMessage(`"${title}" eliminada.`,'success'); await fetchMovies(); }
        else if(res.status===401||res.status===403){ showCustomMessage('No tienes permisos de ADMIN.','error'); }
        else{ showCustomMessage(`Error ${res.status} al eliminar.`,'error'); }
      }catch(e){ showCustomMessage('Error de conexi√≥n.','error'); }
    }

    // ========== CARRITO ==========
    // A√±adir pel√≠cula al carrito y actualizar bot√≥n
    async function handleBuy(movie, btn) {
    const base64 = btoa(`${authUsername}:${authPassword}`);

    const res = await fetch(`${API_URL}/cart/add/${movie.id}`, {
        method: "POST",
        headers: { "Authorization": `Basic ${base64}` }
    });

    if (res.ok) {
        btn.textContent = "A√±adida ‚úÖ";
        btn.disabled = true;
        await loadCartFromBackend(); // ‚¨Ö carrito REAL
        showCustomMessage("Pel√≠cula a√±adida al carrito", "success");
    } else {
        showCustomMessage("Error al a√±adir al carrito", "error");
    }
}

    // Actualiza badge, listado desplegable y visibilidad
    function updateCartUI() {
    const cartItemsList = document.getElementById('cart-items-list');
    const cartTotal = document.getElementById('cart-total');
    const cartBadge = document.getElementById('cart-badge');
    
    // Actualizar contador del carrito
    const itemCount = cart.reduce((total, item) => total + (item.quantity || 1), 0);
    cartBadge.textContent = itemCount;
    cartBadge.style.display = itemCount > 0 ? 'inline-block' : 'none';
    
    if (cart.length === 0) {
        cartItemsList.innerHTML = '<p class="text-gray-400 py-4 text-center">Tu carrito est√° vac√≠o</p>';
        cartTotal.textContent = '0.00‚Ç¨';
        return;
    }

    let total = 0;
    cartItemsList.innerHTML = cart.map(item => {
        const itemTotal = (item.price || 5.99) * (item.quantity || 1);
        total += itemTotal;
        
        return `
            <div class="flex justify-between items-center p-2 hover:bg-gray-700 rounded">
                <div class="flex-1">
                    <p class="text-white">${item.movie?.titulo || 'Pel√≠cula'}</p>
                    <p class="text-gray-400 text-sm">${(item.price || 5.99).toFixed(2)}‚Ç¨ c/u</p>
                </div>
                    <div class="flex items-center">
                        <!-- Grupo de botones de cantidad -->
                        <div class="flex items-center space-x-1">
                            <button onclick="updateCartItemQuantity(${item.id}, ${(item.quantity || 1) - 1})" 
                                    class="px-2 py-1 bg-gray-600 rounded hover:bg-gray-500">-</button>
                            <span class="w-8 text-center">${item.quantity || 1}</span>
                            <button onclick="updateCartItemQuantity(${item.id}, ${(item.quantity || 1) + 1})" 
                                    class="px-2 py-1 bg-gray-600 rounded hover:bg-gray-500">+</button>
                        </div>
                        <!-- Bot√≥n de eliminar con margen izquierdo -->
                        <button onclick="removeFromCart(${item.id})" 
                                class="ml-3 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-500">
                            √ó
                        </button>
                    </div>
            </div>
        `;
    }).join('');

    cartTotal.textContent = `${total.toFixed(2)}‚Ç¨`;
}

async function updateCartItemQuantity(itemId, newQuantity) {
    if (newQuantity < 1) return;
    
    const base64 = btoa(`${authUsername}:${authPassword}`);
    try {
        const res = await fetch(`${API_URL}/cart/${itemId}/quantity?quantity=${newQuantity}`, {
            method: 'PUT',
            headers: { 
                'Authorization': `Basic ${base64}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (res.ok) {
            await loadCartFromBackend();
        } else {
            const error = await res.text();
            showCustomMessage(error || 'Error al actualizar la cantidad', 'error');
        }
    } catch (e) {
        console.error('Error al actualizar cantidad:', e);
        showCustomMessage('Error de conexi√≥n', 'error');
    }
}

function syncBuyButtonsWithCart() {
  // Si el carrito viene del backend: item.movie.id
  const idsEnCarrito = new Set(
    cart.map(item => item.movie ? item.movie.id : item.id) // por si a√∫n usas formato antiguo
  );

  document.querySelectorAll('.buy-btn').forEach(btn => {
    const movieId = Number(btn.dataset.movieId);

    if (idsEnCarrito.has(movieId)) {
      btn.textContent = 'A√±adida ‚úÖ';
      btn.disabled = true;
    } else {
      btn.textContent = 'Comprar Pel√≠cula';
      btn.disabled = false;
    }
  });
}


    // Eliminar del carrito por √≠ndice y refrescar badge/lista
    async function removeFromCart(cartItemId) {
    const base64 = btoa(`${authUsername}:${authPassword}`);

    const res = await fetch(`${API_URL}/cart/${cartItemId}`, {
        method: "DELETE",
        headers: { "Authorization": `Basic ${base64}` }
    });

    if (res.ok) {
        await loadCartFromBackend(); // actualiza carrito REAL
        showCustomMessage("Art√≠culo eliminado del carrito", "success");
    } else {
        showCustomMessage("Error al eliminar del carrito", "error");
    }
}

    // Finalizar compra -> backend /orders/checkout
    async function checkout(){
      if(cart.length === 0) {
        showCustomMessage('El carrito est√° vac√≠o', 'info');
        return;
      }

      try {
        const base64 = btoa(`${authUsername}:${authPassword}`);
        const res = await fetch(`${API_URL}/orders/checkout`, {
          method: 'POST',
          headers: {
            'Authorization': `Basic ${base64}`,
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        });

        const result = await res.json();

        if(res.ok) {
          // Vaciar el carrito solo despu√©s de una compra exitosa
          cart = [];
          updateCartUI();
          // Recargar el carrito desde el backend para asegurar consistencia
          await loadCartFromBackend();
          // Re-activar botones de compra en las tarjetas
          document.querySelectorAll('.buy-btn').forEach(b => {
            b.textContent = 'Comprar Pel√≠cula';
            b.disabled = false;
          });
          showCustomMessage(result.message || 'Compra realizada con √©xito', 'success');
        } else {
          showCustomMessage(result || 'Error al procesar la compra', 'error');
        }
      } catch(e) {
        console.error('Error en checkout:', e);
        showCustomMessage('Error de conexi√≥n: ' + e.message, 'error');
      }
    }

    async function loadCartFromBackend() {
    const base64 = btoa(`${authUsername}:${authPassword}`);

    const res = await fetch(`${API_URL}/cart`, {
        headers: { "Authorization": `Basic ${base64}` }
    });

    if (res.ok) {
        cart = await res.json();   // carrito real
        updateCartUI();
        syncBuyButtonsWithCart();  // ‚¨Ö sincroniza botones
    }
}

    // Toggle del desplegable del carrito
    document.addEventListener('click', (ev)=>{
      const cartContainer = document.getElementById('cart-container');
      const dd=document.getElementById('cart-dropdown');
      const btn=document.getElementById('cart-btn');
      if(btn && btn.contains(ev.target)){
        dd.style.display = (dd.style.display==='block'?'none':'block');
      }else if(cartContainer && !cartContainer.contains(ev.target)){
        dd.style.display='none';
      }
    });

    // Event Listeners
    document.addEventListener('click',(e)=>{
        if(e.target.matches('.movie-card, .movie-card *')){
            const card=e.target.closest('.movie-card');
            if(card && card.dataset.movieId) showMovieDetails(card.dataset.movieId);
        }
    });

    // Backup button click handler
    document.getElementById('backup-btn').addEventListener('click', handleBackup);

    // --- Backup Functionality ---
    async function handleBackup() {
        const backupBtn = document.getElementById('backup-btn');
        const backupSpinner = document.getElementById('backup-spinner');
        const originalText = backupBtn.innerHTML;
        
        if (!isAuthenticated || !authUsername || !authPassword) {
            showCustomMessage('Debes iniciar sesi√≥n como administrador para realizar copias de seguridad.', 'error');
            return;
        }

        try {
            // Disable button and show spinner
            backupBtn.disabled = true;
            backupSpinner.classList.remove('hidden');
            backupBtn.querySelector('span').textContent = 'Procesando...';

            const base64 = btoa(`${authUsername}:${authPassword}`);
            const response = await fetch(`${API_URL}/admin/backup`, {
                method: 'POST',
                headers: {
                    'Authorization': `Basic ${base64}`
                }
            });

            if (!response.ok) {
                throw new Error(`Error ${response.status}: ${response.statusText}`);
            }

            // Get filename from Content-Disposition header
            const contentDisposition = response.headers.get('Content-Disposition');
            const filename = contentDisposition
                ? contentDisposition.split('filename=')[1].replace(/"/g, '')
                : `backup_${new Date().toISOString().split('T')[0]}.zip`;

            // Create blob from response and trigger download
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            // Cleanup
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showCustomMessage('Copia de seguridad generada con √©xito', 'success');
        } catch (error) {
            console.error('Backup error:', error);
            showCustomMessage(`Error al generar la copia de seguridad: ${error.message}`, 'error');
        } finally {
            // Re-enable button and restore original state
            backupBtn.disabled = false;
            backupSpinner.classList.add('hidden');
            backupBtn.querySelector('span').textContent = 'Generar Copia de Seguridad';
        }
    }

    // Funci√≥n para actualizar la vista previa de la imagen
    function updateImagePreview(input) {
        const file = input.files[0];
        const previewImg = document.getElementById('image-preview-img');
        const previewContainer = document.getElementById('image-preview');
        const fileNameSpan = document.getElementById('selected-file-name');
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewContainer.classList.remove('hidden');
            };
            
            reader.readAsDataURL(file);
            
            // Mostrar solo el nombre del archivo, no la ruta completa
            const fileName = file.name;
            fileNameSpan.textContent = fileName;
            
            // Actualizar el campo oculto con el nombre del archivo
            document.getElementById('imagenUrl').value = fileName;
        } else {
            previewContainer.classList.add('hidden');
            fileNameSpan.textContent = '';
            document.getElementById('imagenUrl').value = '';
        }
    }

    // Validar a√±o de la pel√≠cula
    function validateYear(input) {
        const year = input.value;
        const errorElement = document.getElementById('year-error');
        
        if (year.length < 3 || year.length > 4) {
            input.classList.add('border-red-500');
            errorElement.classList.remove('hidden');
            input.setCustomValidity('El a√±o debe tener entre 3 y 4 d√≠gitos');
        } else {
            input.classList.remove('border-red-500');
            errorElement.classList.add('hidden');
            input.setCustomValidity('');
        }
    }

    // --- Inicializaci√≥n ---
    document.addEventListener('DOMContentLoaded', () => {
      // Inicializar la UI
      updateUI(null, false);

      // Configurar manejadores de eventos de autenticaci√≥n
      const openLoginBtn = document.getElementById('open-login-btn');
      const openRegisterBtn = document.getElementById('open-register-btn');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      
      if (openLoginBtn) {
        openLoginBtn.addEventListener('click', () => openModal('login-modal'));
      }
      
      if (openRegisterBtn) {
        openRegisterBtn.addEventListener('click', () => openModal('register-modal'));
      }
      
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          handleLogin();
        });
      }
      
      if (registerForm) {
        registerForm.addEventListener('submit', function(e) {
          e.preventDefault();
          handleRegister();
        });
      }
      
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
      }

      // Configurar formulario de pel√≠culas
      const movieForm = document.getElementById('movie-form');
      if (movieForm) {
        movieForm.addEventListener('submit', handleMovieFormSubmit);
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        if (cancelEditBtn) {
          cancelEditBtn.addEventListener('click', resetMovieForm);
        }
      }
    });

</script>
</body>
</html>